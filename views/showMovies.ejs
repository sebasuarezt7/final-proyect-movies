<%- include('partials/header') %>

<main class="movies-page">
    <h1>All Movies (<%= movies.length %> found)</h1>
    
    <!-- Enhanced Search and Filter Form -->
    <div class="search-section">
        <form method="GET" class="search-form">
            <!-- Search Input -->
            <div class="search-group">
                <input type="text" name="search" placeholder="Search movies..." value="<%= search %>">
                <% if (search) { %>
                    <a href="/movies" class="clear-search">✕ Clear</a>
                <% } %>
            </div>
            
            <!-- Sort Dropdown -->
            <select name="sort">
                <option value="name" <%= sortBy === 'name' ? 'selected' : '' %>>Sort by Name (A-Z)</option>
                <option value="rating" <%= sortBy === 'rating' ? 'selected' : '' %>>Sort by Rating (High to Low)</option>
                <option value="year" <%= sortBy === 'year' ? 'selected' : '' %>>Sort by Year (Newest First)</option>
            </select>
            
            <!-- Genre Filter -->
            <select name="genre">
                <option value="">All Genres</option>
                <% allGenres.forEach(genreOption => { %>
                    <option value="<%= genreOption %>" <%= genre === genreOption ? 'selected' : '' %>><%= genreOption %></option>
                <% }) %>
            </select>
            
            <!-- Rating Filter -->
            <select name="minRating">
                <option value="">Any Rating</option>
                <option value="8" <%= minRating === '8' ? 'selected' : '' %>>8+ Stars</option>
                <option value="7" <%= minRating === '7' ? 'selected' : '' %>>7+ Stars</option>
                <option value="6" <%= minRating === '6' ? 'selected' : '' %>>6+ Stars</option>
                <option value="5" <%= minRating === '5' ? 'selected' : '' %>>5+ Stars</option>
            </select>
            
            <button type="submit" class="search-btn">Apply Filters</button>
        </form>
    </div>
    
    <% if (movies.length === 0) { %>
        <div class="no-results">
            <p>No movies found matching your criteria.</p>
            <a href="/movies" class="btn-link">Show All Movies</a>
        </div>
    <% } else { %>
        <div class="movies-grid">
            <% movies.forEach(movie => { %>
                <div class="movie-card">
                    <h3><%= movie.name %></h3>
                    <p><strong>Year:</strong> <%= movie.year %></p>
                    <p><strong>Rating:</strong> 
                        <% for(let i = 1; i <= 10; i++) { %>
                            <% if(i <= movie.rating) { %>★<% } else { %>☆<% } %>
                        <% } %>
                        (<%= movie.rating %>/10)
                    </p>
                    <% if (movie.genres && movie.genres.length > 0) { %>
                        <p><strong>Genres:</strong> <%= movie.genres.join(', ') %></p>
                    <% } %>
                    <a class="btn-link" href="/movies/<%= movie._id %>">Details</a>
                </div>
            <% }) %>
        </div>
    <% } %>

</main>

<%- include('partials/footer') %>